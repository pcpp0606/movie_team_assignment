<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Detail</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <!-- Bootstrap Icons CSS 파일 로드 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css" />
    <script>
        function calculateStar(vote_average) { // 별 아이콘의 갯수를 계산
            let resultStar = "";
            for (let i = 0; i < 10; i++) {//10점만점이므로 아이콘 10개를 생성한다.
                resultStar += vote_average < i ? `<i class="bi bi-star"></i>` :  //이 때 i보다 vote_average가 낮다면 속이 빈 star를 출력한다.
                    vote_average - 1 < i ? `<i class="bi bi-star-half"></i>` : `<i class="bi bi-star-fill"></i>`; //vote_average에서 -1를 뺀 값과 i를 비교하여 star-fill과 star-half를 결정한다.
            }

            return resultStar;
        }
        document.addEventListener('DOMContentLoaded', function () {
            //로컬 스토리지에 저장되어 있는 movie가져오기
            const movie = JSON.parse(localStorage.getItem('movie'));

            // 영화 정보가 로컬 스토리지에 저장되어 있는지 확인
            if (movie) {
                const movieDetailContainer = document.getElementById('movie-detail');
                movieDetailContainer.innerHTML = `
                <div class="card mb-3" style="max-width: 100%;" id="${movie.id}">
                    <div class="row g-0">
                        <div class="col-md-4">
                            <img src="https://image.tmdb.org/t/p/w500${movie.poster_path}" class="img-fluid rounded-start" alt="...">
                        </div>
                        <div class="col-md-8">
                            <div class="card-body">
                                <h5 class="card-title">${movie.title}</h5>
                                <p class="card-text">${movie.overview}</p>
                                <p class="card-text"><small class="text-body-secondary"> Rating : ${calculateStar(movie.vote_average)}
                                    ${movie.vote_average}</small></p>
                            </div>
                        </div>
                        <button type="button" class="btn btn-secondary" id="back-button">Back</button>
                    </div>
                 </div>`;
            } else {
                console.error('영화 정보를 찾을 수 없습니다.');
            }

            //돌아가기 버튼 기능
            const backBtn = document.getElementById("back-button");
            backBtn.addEventListener('click', () => {
                localStorage.setItem('fromIndex', 'true'); // 상세 페이지로 왔다는 것을 표시
                // 타이틀 페이지로 이동
                window.location.href = 'index.html';
            });

        });

        //html창이 종료될 때 
        window.addEventListener('unload', function () {
            localStorage.removeItem('movie'); //상세정보를 가져오기위해 생성한 movie를 삭제함
        });
    </script>
</head>

<body>
    <div id="movie-detail"></div>
</body>

</html>